<?php    Scripts::addModule('fileuploader');    Scripts::addModule('bazalt gallery');    Scripts::addModule('jQuery Tmpl');    Scripts::addModule('fancybox');?><div class="bz-form-row">    <?php echo $element->renderLabel(); ?>    <div <?php echo $element->getAttributesString() ?>></div>    <div class="image">        <div class="bz-gallery-container" id="p_<?php echo $element->id(); ?>">            <div class="bz-gallery-image ui-corner-all">                <a href="<?php echo $element->value(); ?>">                    <img src="<?php echo $element->value(); ?>" />                </a>            </div>            <div class="clear"></div>            <a href="javascript: void(null);" class="bz-gallery-delete ui-state-error ui-corner-all ui-float-right">                <span class="ui-icon ui-icon-trash"></span> Delete            </a>            <input type="hidden" name="<?php echo $element->name(); ?>" value="<?php echo $element->value(); ?>"/>        </div>    </div>    <div class="spacer"></div>    <?php echo $element->renderError(); ?>    <?php echo $element->renderComment(); ?></div><script>$(function() {    var imgOptions = { transitionIn: 'elastic', transitionOut: 'elastic'};    var <?php echo $element->id(); ?> = new qq.FileUploader({        element: document.getElementById("<?php echo $element->id(); ?>"),        allowedExtensions: ["jpg", "png"],        action: "<?php echo CMS_Mapper::urlFor('CMS.Upload'); ?>",        template: '<div class="qq-uploader">' +                  '<div class="qq-upload-drop-area"><span>Drop files here to upload</span></div>' +                  '<a class="fg-button qq-upload-button ui-state-default ui-corner-all ui-priority-primary fg-button-icon-left" id="jQueryButton" ' +                  'style="display: inline-block; float: none;" href="javascript: ;"><span class="ui-icon ui-icon-folder-open"></span>Upload</a>' +                  '<ul class="qq-upload-list"></ul>' +                  '</div>',        params: '',        onComplete: function(id, fileName, responseJSON) {            if (responseJSON.success) {               var photo = responseJSON.url;               $("#<?php echo $element->id(); ?>").parent().find(".image").show();               $("#p_<?php echo $element->id(); ?> img").attr("src", responseJSON.thumb);               $("#p_<?php echo $element->id(); ?> a").attr("href", photo);               $('input[name="<?php echo $element->name(); ?>"]').val(photo);               $('.qq-upload-list .qq-upload-success').remove();            }        }    });    $('#<?php echo $element->id(); ?>').parent().find('.image .bz-gallery-image a').fancybox(imgOptions);    $('.bz-gallery-delete').live('click', function(){         $('input[name="<?php echo $element->name(); ?>"]').val('');         $('#p_<?php echo $element->id(); ?> img').attr('src', '');         $('#p_<?php echo $element->id(); ?> a').attr('href', '');         $('#<?php echo $element->id(); ?>').parent().find('.image').hide();         return false;    });});</script>