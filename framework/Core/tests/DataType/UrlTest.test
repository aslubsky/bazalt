<?php

class UrlTest extends Test_BaseCase
{
    protected $url;

    public function setUp()
    {
        $this->url = new DataType_Url('http://username:password@hostname/path?arg=value#anchor');
    }

    public function tearDown()
    {
        unset($this->url);
    }

    public function testIsValid()
    {
        $this->assertFalse(DataType_Url::isValid('test'));

        $this->assertTrue(DataType_Url::isValid('http://test.ua/test?test=test#test'));
    }

    public function testGetReferer()
    {
        $_SERVER['HTTP_REFERER'] = 'test';

        $this->assertEquals(DataType_Url::getReferer(), 'test');
    }

    public function testGetRequestUrl()
    {
        $_SERVER['REQUEST_URI'] = '/test1';

        $this->assertEquals(DataType_Url::getRequestUrl(), '/test1');
        $_SERVER['PATH_INFO'] = '/test2';

        $this->assertEquals(DataType_Url::getRequestUrl(), '/test2');

        $_SERVER['HTTP_X_ORIGINAL_URL'] = '/test3'; //IIS
        $this->assertEquals(DataType_Url::getRequestUrl(), '/test3');
    }

    public function testCleanUrl()
    {
        $url = DataType_Url::cleanUrl('Mess\'d up --text-- just (to) stress /test/ ?our! `little` \\clean\\ url fun.ction!?-->');
        $this->assertEquals($url, 'mess-d-up-text-just-to-stress-test-our-little-clean-url-fun-ction');

        //$url = DataType_Url::cleanUrl("Perché l'erba è verde?", "'"); // Italian
        //$this->assertEquals($url, 'perche-l-erba-e-verde');

        //$url = DataType_Url::cleanUrl("Peux-tu m'aider s'il te plaît?", "'"); // French
        //$this->assertEquals($url, 'peux-tu-m-aider-s-il-te-plait');

        //$url = DataType_Url::cleanUrl("Tänk efter nu – förr'n vi föser dig bort"); // Swedish
        //$this->assertEquals($url, 'tank-efter-nu-forrn-vi-foser-dig-bort');

        //$url = DataType_Url::cleanUrl("ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖÙÚÛÜÝßàáâãäåæçèéêëìíîïðñòóôõöùúûüýÿ");
        //$this->assertEquals($url, 'aaaaaaaeceeeeiiiidnooooouuuuyssaaaaaaaeceeeeiiiidnooooouuuuyy');

        $url = DataType_Url::cleanUrl("Custom`delimiter*example", array('*', '`'));
        $this->assertEquals($url, 'custom-delimiter-example');

        $url = DataType_Url::cleanUrl("My+Last_Crazy|delimiter/example", '', ' ');
        $this->assertEquals($url, 'my last crazy delimiter example');
    }

    public function testEncodeId()
    {
        $id = DataType_Url::encodeId(100500);
        $this->assertEquals($id, '3jxw');
    }

    public function testDecodeId()
    {
        $id = DataType_Url::decodeId('3jxw');
        $this->assertEquals($id, 100500);
    }
}